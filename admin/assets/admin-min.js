var cuato_active_selected_step=null,cauto_step_popup_step="#cauto-popup-start-step";jQuery(document).ready((function(){jQuery("#cauto-new-case").on("click",(function(){jQuery("#cauto-popup-new-flow").fadeIn(200)})),jQuery("body").on("click",".cauto-cancel",(function(){let e=jQuery(this).closest(".cauto-popup");jQuery("#cauto-save-new-flow").removeAttr("data-edit"),jQuery("#cauto-new-flow-name").val(""),jQuery("#cauto-flow-stop-on-error").prop("checked",!1),jQuery(e).fadeOut(200)})),jQuery("#cauto-save-new-flow").on("click",(function(){cauto_do_save_flow(this)})),jQuery(".cauto_steps_builder").sortable({revert:!0,forceHelperSize:!0}),jQuery(".cauto-steps-draggable").draggable({connectToSortable:".cauto_steps_builder",helper:"clone",revert:"invalid",stop:function(e,t){t.helper.addClass("cauto-added-step"),t.helper.append('<input type="hidden">');let a=t.helper.find("div");jQuery(a).append('<span class="cauto_describe_step_label"></span>')}}),jQuery("body").on("click",".cauto_steps_builder .cauto-steps-draggable, .cauto_steps_builder .cauto-steps-el-saved",(function(){jQuery(".cauto_steps_builder").find("li").removeClass("active"),jQuery(this).toggleClass("active")})),jQuery("body").on("dblclick",".cauto_steps_builder .cauto-steps-draggable, .cauto_steps_builder .cauto-steps-el-saved",(function(){let e=jQuery(this).find("div").data("step");if(jQuery(this).removeClass("active"),e){if(jQuery(this).find("div").data("no-settings"))return;cuato_active_selected_step=jQuery(this),jQuery("#cauto-popup-content-step").html('<div class="cauto-popup-loader"><span class="cauto-icon-spinner5 cauto-popup-loader cauto-loader"></span></div>'),jQuery(cauto_step_popup_step).fadeIn(200,(function(){cauto_build_step_settings(e)}))}})),jQuery("html").keyup((function(e){46==e.keyCode&&jQuery(".cauto_steps_builder").find("li.active").remove()})),jQuery("body").on("click","#cauto-save-step",(function(){let e=jQuery(this).closest("div#cauto-step-config-control-area"),t=jQuery(e).find("input[type=hidden]#cauto_step_config_field_ids").val();cauto_validate_set_step_config(t),jQuery(this).prop("disabled",!0),jQuery(this).find("span.dashicons").attr("class","cauto-icon-spinner5 cauto-icon cauto-loader"),jQuery(".cauto-cancel").prop("disabled",!0),jQuery("#cauto-delete-step").hide(),cauto_do_save_step()})),jQuery("body").on("click","#cauto-delete-step",(function(){jQuery(this).hide();let e=jQuery("#cauto-delete-step-confirm").closest("div.cauto_button_wrapper");jQuery(e).removeClass("hidden")})),jQuery("body").on("click","#cauto-delete-step-confirm",(function(){jQuery(this).prop("disabled",!0),jQuery(".cauto-cancel").prop("disabled",!0),jQuery("#cauto-save-step").prop("disabled",!0),cauto_do_save_step("delete_flow")})),jQuery("#cauto-save-flow").on("click",(function(){jQuery("#cauto-run-flow, #cauto-delete-flow").prop("disabled",!0),jQuery(this).find("span.dashicons").attr("class","cauto-icon-spinner5 cauto-icon cauto-loader"),cauto_do_save_step("flow_save")})),jQuery("#cauto-run-flow").on("click",(function(){let e=jQuery(this).data("id");jQuery(this).find("span.dashicons").attr("class","cauto-icon-spinner5 cauto-icon cauto-loader"),cauto_run_flow(e)})),jQuery("#cauto-edit-flow").on("click",(function(){jQuery("#cauto-popup-new-flow").fadeIn(200),jQuery("#cauto-save-new-flow").attr("data-edit",cauto_ajax.flow_id),cauto_get_flow_details()})),jQuery("#cauto-results-list li").on("click",(function(){jQuery("#cauto-results-list li").removeClass("active"),jQuery(this).addClass("active");let e=jQuery(this).data("runner-id");cauto_load_runner_results(e)})),cuato_load_more_link(),jQuery(".cauto-see-other-runners span").on("click",(function(){cauto_load_more_runners()}))}));const cauto_do_save_step=(e=null)=>{let t=jQuery("#cauto-flow-id").val(),a=[];jQuery(".cauto_steps_builder").find("li.cauto-steps-el").each((function(){let e=jQuery(this).find("div").data("step"),t=jQuery(this).find("input[type=hidden]").val();a.push({step:e,record:t})})),jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_do_save_flow",nonce:cauto_ajax.nonce,step:JSON.stringify(a),flow_id:t},success:function(t){t&&("success"===(t=JSON.parse(t)).status?("flow_save"===e?(jQuery("#cauto-run-flow, #cauto-delete-flow").prop("disabled",!1),jQuery("#cauto-save-flow").find("span.cauto-icon").attr("class","dashicons dashicons-saved")):"delete_flow"===e?(jQuery(cuato_active_selected_step).remove(),cuato_active_selected_step=null):cauto_describe_step_action(jQuery("#cauto_step_config_describe").val()),jQuery(cauto_step_popup_step).fadeOut(200)):console.error("CAUTO ERROR: unable to save step, please contact support"))}})},cauto_describe_step_action=(e=null)=>{if(!e)return;if(void 0===(e=JSON.parse(e)).describe_text||!e.describe_text||""===e.describe_text)return;let t=e.describe_text;if(Array.isArray(e.selector))for(let a in e.selector)t=t.replace("{"+e.selector[a]+"}",jQuery(e.selector[a]).val());else t=t.replace("{"+e.selector+"}",jQuery(e.selector).val());jQuery(cuato_active_selected_step).addClass("cauto_step_set_wide"),jQuery(cuato_active_selected_step).find("span.cauto_describe_step_label").html("<b>"+t+"</b>")},cauto_validate_set_step_config=(e=null)=>{if(e&&(e=JSON.parse(e))){for(let t in e)switch(e[t].field){case"input":case"select":case"textarea":case"group":case"toggle":switch(e[t].type){case"checkbox":case"radio":if(e[t].id){if(jQuery("#"+e[t].id).is(":checked")){let a=jQuery("#"+e[t].id).val();e[t].value=a||!0}}else if(e[t].class){let a=[];jQuery("."+e[t].class).each((function(){if(jQuery(this).is(":checked")){let e=!jQuery(this).val()||jQuery(this).val();a.push(e)}})),e[t].value=a}else console.error("CAUTO STEP FIELD ERROR: No element identifier was found for radio button");break;default:let a=e[t].id?"#"+e[t].id:"."+e[t].id;e[t].value=jQuery(a).val()}}cuato_active_selected_step?jQuery(cuato_active_selected_step).find("input[type=hidden]").val(JSON.stringify(e)):console.error("CAUTO STEP ERROR: No step indentifier is found. Please contact developer")}},cauto_create_unique_id=()=>Math.round((new Date).getTime()+100*Math.random()),cauto_build_step_settings=e=>{let t=jQuery("#cauto-flow-id").val(),a=jQuery(cuato_active_selected_step).find("input[type=hidden]").val();jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_steps_ui",nonce:cauto_ajax.nonce,type:e,flow_id:t,saved_data:a},success:function(e){e&&("success"===(e=JSON.parse(e)).status?jQuery(cauto_step_popup_step+" .cauto-popup-content").html(e.html):alert(e.message))}})},cauto_do_save_flow=e=>{let t=jQuery("#cauto-new-flow-name").val();if(!t)return;let a=jQuery("#cauto-flow-stop-on-error").is(":checked");jQuery(e).find("span.cauto_button_text").text("Saving..."),jQuery(e).find("span.dashicons").removeClass("dashicons-saved").addClass("cauto-icon-spinner5 cauto-loader"),jQuery(".cauto-cancel").prop("disabled",!0),jQuery(e).prop("disabled",!0);let o=jQuery(e).data("edit");jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_new_flow",nonce:cauto_ajax.nonce,name:t,stop_on_error:a,is_edit:o},success:function(e){e&&("success"===(e=JSON.parse(e)).status?window.location=e.redirect_to:alert(e.message))}})},cauto_run_flow=e=>{e&&jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_setup_run_flow",nonce:cauto_ajax.nonce,flow_id:e},success:function(e){if(e)if("success"===(e=JSON.parse(e)).status){let t=e.url;""!==t?window.open(t,"_blank"):console.error("CAUTO ERROR: Flow and Runner not found."),jQuery("#cauto-run-flow").find("span.cauto-icon").attr("class","dashicons dashicons-controls-play")}else console.error("CAUTO ERROR: "+e.message)}})},cauto_get_flow_details=()=>{let e=cauto_ajax.flow_id;e&&(jQuery("#cauto-new-flow-name, #cauto-flow-stop-on-error, #cauto-save-new-flow, .cauto-cancel").prop("disabled",!0),jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_get_flow_details_to_edit",nonce:cauto_ajax.nonce,flow_id:e},success:function(e){e&&("success"===(e=JSON.parse(e)).status?(jQuery("#cauto-new-flow-name").val(e.data.title),e.data.stop_on_error?jQuery("#cauto-flow-stop-on-error").prop("checked",!0):jQuery("#cauto-flow-stop-on-error").prop("checked",!1)):console.error("CAUTO ERROR: "+e.message)),jQuery("#cauto-new-flow-name, #cauto-flow-stop-on-error, #cauto-save-new-flow, .cauto-cancel").prop("disabled",!1)}}))},cauto_load_runner_results=(e=0)=>{0!==e&&jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_load_runner_results",nonce:cauto_ajax.nonce,runner_id:e},success:function(e){e&&("success"===(e=JSON.parse(e)).status||console.error("CAUTO ERROR: "+e.message))}})},cuato_load_more_link=()=>{jQuery("#cauto-results-list").data("rucnt")===jQuery("#cauto-results-list li").length&&jQuery(".cauto-see-other-runners").remove()},cauto_load_more_runners=()=>{if(jQuery(".cauto-see-other-runners span").hasClass("loading"))return;jQuery(".cauto-see-other-runners span").addClass("loading");let e=jQuery("#cauto-results-list li").length,t=jQuery("#cauto-results-list").data("flow-id");jQuery.ajax({type:"post",url:cauto_ajax.ajaxurl,data:{action:"cauto_load_more_runner_results",nonce:cauto_ajax.nonce,flow_id:t,offset:e},success:function(e){e&&("success"===(e=JSON.parse(e)).status?void 0!==e.content&&jQuery("#cauto-results-list").append(e.content):console.error("CAUTO ERROR: "+e.message));let t=jQuery("#cauto-results-list").data("rucnt");jQuery("#cauto-results-list li").length>=t&&jQuery(".cauto-see-other-runners").remove(),jQuery(".cauto-see-other-runners span").removeClass("loading")}})};